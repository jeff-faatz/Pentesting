#!/bin/bash

# This script is for Educational purposes only. Any actions and or activities related to the material contained within this script is solely your responsibility.

# To run the script - ./full_enumeration.sh TARGETDOMAIN
# To run a single scanning program - ./full_enumeration.sh TARGETDOMAIN SCANTYPE-only

# Required .lib file
source ./scans.lib

echo "
  _____   ____    _   _   _   _   _  __  __  __    ___    _   _   _  __  _____  __   __
 |_   _| |  _ \  | | | | | \ | | | |/ / |  \/  |  / _ \  | \ | | | |/ / | ____| \ \ / /
   | |   | |_) | | | | | |  \| | | ' /  | |\/| | | | | | |  \| | | ' /  |  _|    \ V / 
   | |   |  _ <  | |_| | | |\  | | . \  | |  | | | |_| | | |\  | | . \  | |___    | |  
   |_|   |_| \_\  \___/  |_| \_| |_|\_\ |_|  |_|  \___/  |_| \_| |_|\_\ |_____|   |_|  
"
                                                                                       

getopts "m:" OPTION
MODE=$OPTARG

for i in "${@:$OPTIND:$#}"
do
    DOMAIN=$1
    
# Makes a new directory in your current directory named after your DOMAIN    
    DIRECTORY=${DOMAIN}
    echo "Creating directory $DIRECTORY."
    mkdir $DIRECTORY
    
# Scan types
    case $MODE in
        nmap-only)
            nmap_scan
            ;;
        gobuster-only)
            dirsearch_scan
            ;;
        theharvester-only)
            theharvester_scan
            ;;
        dnsrecon-only)
            dnsrecon_scan
            ;;
        wfuzz-only)
            wfuzz_scan
            ;;
        sslyze-only)
            sslyze_scan
            ;;
        *)
            nmap_scan
            gobuster_scan
            theharvester_scan
            dnsrecon_scan
            wfuzz_scan
            sslyze_scan
            ;;
    esac
    
# Generates a cobined report of all the individual scan reports
    echo "Generating report for $DOMAIN..."
    echo ""
    TODAY=$(date)
    echo "This scan was created on $TODAY" > $DIRECTORY/report
    echo ""
    if [ -f $DIRECTORY/nmap ];then
        echo "Results for nmap:" >> $DIRECTORY/report
        cat $DIRECTORY/nmap >> $DIRECTORY/report
    fi
    echo ""
    if [ -f $DIRECTORY/gobuster ];then
        echo "Results for gobuster:" >> $DIRECTORY/report
        cat $DIRECTORY/gobuster >> $DIRECTORY/report
    fi
    echo ""
    if [ -f $DIRECTORY/theharvester ];then
        echo "Results for theharvester:" >> $DIRECTORY/report
        cat $DIRECTORY/theharvester >> $DIRECTORY/report
    fi
    echo ""
    if [ -f $DIRECTORY/dnsrecon ];then
        echo "Results for dnsrecon:" >> $DIRECTORY/report
        cat $DIRECTORY/dnsrecon >> $DIRECTORY/report
    fi
    echo ""
    if [ -f $DIRECTORY/wfuzz ];then
        echo "Results for wfuzz:" >> $DIRECTORY/report
        cat $DIRECTORY/wfuzz >> $DIRECTORY/report
    fi
    echo ""
    if [ -f $DIRECTORY/sslyze ];then
        echo "Results for sslyze:" >> $DIRECTORY/report
        cat $DIRECTORY/sslyze >> $DIRECTORY/report
    fi
done
